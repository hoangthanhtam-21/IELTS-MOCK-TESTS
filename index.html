<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Reading Practice Pro</title>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Playfair+Display:wght@700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .font-serif { font-family: 'Playfair Display', serif; }
        .user-highlight { border-radius: 4px; padding: 2px 0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .passage-content p { margin-bottom: 1.5rem; text-align: justify; line-height: 1.8; }
    </style>
</head>
<body class="bg-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Icons implementation using SVG
        const TimerIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const PlayIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>;
        const InfoIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>;

        const PASSAGES_DATA = [
            {
                id: 1,
                title: "How tennis rackets have changed",
                content: `
                    <p><span id="s1">In 2016, the British professional tennis player Andy Murray was ranked as the world’s number one.</span> <span id="s3">Yet five years previously, he had been regarded as a talented outsider...</span></p>
                    <p><span id="s15">They explain how they have adjusted not only racket length, but even experimented with different kinds of paint.</span> <span id="s20">It created a string bed that generated so much topspin that it was quickly banned.</span> <span id="s22">Today it is equal in significance to nutrition or training.</span> <span id="s27">At one time, all tennis rackets were strung with natural gut made from the outer layer of sheep or cow intestines.</span> <span id="s36">Pete Sampras added lead weights onto his rackets.</span> <span id="s40">Gonçalo Oliveira replaced the original grips of his rackets with something thinner.</span></p>
                `,
                groups: [
                    {
                        instruction: "Do the following statements agree with the information? TRUE, FALSE, or NOT GIVEN.",
                        questions: [
                            { id: "q1", type: "choice", text: "People had expected Andy Murray to become the world’s top tennis player for at least five years before 2016.", options: ["TRUE", "FALSE", "NOT GIVEN"], correct: "FALSE", explanation: "Murray was considered a talented outsider 5 years prior.", sourceId: "s3" }
                        ]
                    },
                    {
                        instruction: "Complete the notes below. Choose ONE WORD ONLY.",
                        questions: [
                            { id: "q8", type: "gap", text: "Mike and Bob Bryan made changes to the types of ______ used on their racket frames.", correct: "paint", explanation: "They experimented with different kinds of paint.", sourceId: "s15" },
                            { id: "q11", type: "gap", text: "All rackets used to have natural strings made from the ______ of animals.", correct: "intestines/gut", explanation: "Made from sheep or cow intestines/gut.", sourceId: "s27" }
                        ]
                    }
                ]
            },
            {
                id: 2,
                title: "Should we try to bring extinct species back to life?",
                content: `
                    <p><span id="s44">Sadly, the passenger pigeon’s existence came to an end on 1 September 1914.</span> <span id="s46">The basic premise involves using cloning technology to turn the DNA...</span> <span id="s53">The return of thylacines to Tasmania could help to ensure that devils are never again subjected to risks.</span> <span id="s58">Beth Shapiro says there is no way to bring back something 100 per cent identical; a hybrid is a more practical approach.</span> <span id="s62">Since the disappearance of this key species, ecosystems in the eastern US have suffered.</span> <span id="s74">Shapiro prefers to focus on how technology could be used to fully understand why various species went extinct.</span> <span id="s75">She says there’s an incredible moral hazard to not do anything at all.</span></p>
                `,
                groups: [
                    {
                        instruction: "Which paragraph contains the following information? A-F.",
                        questions: [
                            { id: "q14", type: "gap", text: "a reference to how further disappearance of multiple species could be avoided: ______", correct: "F", explanation: "Paragraph F discusses preventing mass extinctions.", sourceId: "s74" }
                        ]
                    },
                    {
                        instruction: "Match each statement with the correct person: Ben Novak, Michael Archer, Beth Shapiro, George Church.",
                        questions: [
                            { id: "q23", type: "choice", text: "Reintroducing an extinct species could improve the health of a particular species living there.", options: ["Ben Novak", "Michael Archer", "Beth Shapiro", "George Church"], correct: "Michael Archer", explanation: "Archer mentions thylacines helping Tasmanian devils' health.", sourceId: "s53" },
                            { id: "q24", type: "choice", text: "It is important to concentrate on the causes of animals becoming extinct.", options: ["Ben Novak", "Michael Archer", "Beth Shapiro", "George Church"], correct: "Beth Shapiro", explanation: "Shapiro wants to understand why species went extinct first.", sourceId: "s74" },
                            { id: "q25", type: "choice", text: "A more realistic goal is to create an animal similar to an extinct species, rather than an identical copy.", options: ["Ben Novak", "Michael Archer", "Beth Shapiro", "George Church"], correct: "Beth Shapiro", explanation: "Shapiro suggests hybrids are more practical.", sourceId: "s58" },
                            { id: "q26", type: "choice", text: "There is a moral obligation to take action to try to save some species.", options: ["Ben Novak", "Michael Archer", "Beth Shapiro", "George Church"], correct: "Beth Shapiro", explanation: "Shapiro mentions the 'moral hazard' of doing nothing.", sourceId: "s75" }
                        ]
                    }
                ]
            },
            {
                id: 3,
                title: "Marketing And Mind Control",
                content: `
                    <p><span id="s84">The objective was to promote diamonds as the symbol of everlasting love.</span> <span id="s91">Our olfactory system is targeted by scents aimed at enticing us to linger in a retail outlet.</span> <span id="s93">We are swayed by advertising into paying for bottled water that we can obtain for free.</span> <span id="s103">Potato washing spread from monkey to monkey on the island of Koshima.</span> <span id="s106">Learning by observation helps deal with everyday problems like navigating a subway.</span> <span id="s110">Ads are populated with attractive, successful looking individuals.</span> <span id="s112">A number of studies indicate that some animals also imitate dominant members.</span> <span id="s114">Frans de Waal noted chimpanzees limping like a dominant male.</span> <span id="s117">Imitators copied Dick Fosbury's jumping style, not his brand of shoes.</span> <span id="s120">Stealth marketing involves people paid to covertly promote products.</span></p>
                `,
                groups: [
                    {
                        instruction: "Choose the correct letter A, B, C or D.",
                        questions: [
                            { id: "q27", type: "choice", text: "Which marketing technique attempts to make consumers stay in a shop for longer?", options: ["A. playing music", "B. emitting pleasant scents", "C. posters", "D. announcements"], correct: "B. emitting pleasant scents", explanation: "Olfactory system is targeted to make us linger.", sourceId: "s91" }
                        ]
                    },
                    {
                        instruction: "Match the sentence endings A-G.",
                        questions: [
                            { id: "q37", type: "choice", text: "The behaviour of the monkeys on the island of Koshima showed that", options: ["A. imitated success", "C. imitated high status", "E. unaware consumers", "F. animals develop new habits by observation"], correct: "F. animals develop new habits by observation", explanation: "Observation led to potato washing habit.", sourceId: "s103" },
                            { id: "q38", type: "choice", text: "Primatologist Frans de Waal found that", options: ["A. imitated success", "C. an animal would imitate another that had higher status.", "E. unaware consumers", "F. habits by observation"], correct: "C. an animal would imitate another that had higher status.", explanation: "Chimps imitated the dominant male.", sourceId: "s114" },
                            { id: "q39", type: "choice", text: "Dick Fosbury is mentioned in order to show that", options: ["A. people imitated behaviour that was linked with success.", "C. imitated high status", "E. unaware consumers", "F. habits by observation"], correct: "A. people imitated behaviour that was linked with success.", explanation: "Copying style (success) vs shoes (product).", sourceId: "s117" },
                            { id: "q40", type: "choice", text: "A feature of some modern marketing campaigns is that", options: ["A. imitated success", "C. imitated high status", "E. products are marketed to consumers unaware it is occurring", "F. habits by observation"], correct: "E. products are marketed to consumers unaware it is occurring", explanation: "Stealth marketing is covert.", sourceId: "s120" }
                        ]
                    }
                ]
            }
        ];

        function App() {
            const [status, setStatus] = useState('idle');
            const [currentPassage, setCurrentPassage] = useState(0);
            const [answers, setAnswers] = useState({});
            const [timeLeft, setTimeLeft] = useState(3600);
            const [reviewId, setReviewId] = useState(null);

            useEffect(() => {
                let timer;
                if (status === 'testing' && timeLeft > 0) {
                    timer = setInterval(() => setTimeLeft(prev => prev - 1), 1000);
                }
                return () => clearInterval(timer);
            }, [status, timeLeft]);

            const formatTime = (s) => {
                const m = Math.floor(s / 60);
                const rs = s % 60;
                return `${m}:${rs.toString().padStart(2, '0')}`;
            };

            const checkAns = (u, c) => {
                if (!u) return false;
                const user = u.trim().toLowerCase();
                const correct = c.trim().toLowerCase();
                if (correct.includes('/')) return correct.split('/').some(part => part.trim() === user);
                if (user.length === 1 && correct.startsWith(user)) return true;
                return user === correct;
            };

            const calculateScore = () => {
                let score = 0;
                PASSAGES_DATA.forEach(p => p.groups.forEach(g => g.questions.forEach(q => {
                    if (checkAns(answers[q.id], q.correct)) score++;
                })));
                return score;
            };

            if (status === 'idle') {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-slate-50">
                        <div className="bg-white p-12 rounded-[2.5rem] shadow-2xl border border-slate-100 text-center max-w-md w-full">
                            <div className="w-20 h-20 bg-blue-600 rounded-3xl flex items-center justify-center mx-auto mb-8 shadow-lg shadow-blue-200">
                                <TimerIcon />
                            </div>
                            <h1 className="text-4xl font-black text-slate-800 mb-4 tracking-tight">IELTS PRO</h1>
                            <p className="text-slate-500 mb-10 font-medium italic">Cumulative Reading Test (U5-U8)</p>
                            <button onClick={() => setStatus('testing')} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-5 rounded-2xl transition-all active:scale-95 shadow-lg flex items-center justify-center gap-3">
                                <PlayIcon /> BẮT ĐẦU LÀM BÀI
                            </button>
                        </div>
                    </div>
                );
            }

            if (status === 'finished') {
                const score = calculateScore();
                return (
                    <div className="min-h-screen flex items-center justify-center bg-slate-100">
                        <div className="bg-white p-16 rounded-[3rem] shadow-2xl text-center max-w-2xl w-full border">
                            <h2 className="text-sm font-black text-blue-600 uppercase tracking-[0.3em] mb-4">KẾT QUẢ CỦA BẠN</h2>
                            <div className="text-9xl font-black text-slate-800 mb-6">{score}</div>
                            <p className="text-slate-400 font-bold mb-10 uppercase tracking-widest">ĐIỂM SỐ / 40 CÂU</p>
                            <button onClick={() => setStatus('review')} className="bg-slate-800 text-white px-12 py-4 rounded-2xl font-bold hover:bg-slate-900 transition-all">XEM LẠI ĐÁP ÁN</button>
                        </div>
                    </div>
                );
            }

            const passage = PASSAGES_DATA[currentPassage];

            return (
                <div className="h-screen flex flex-col bg-white overflow-hidden">
                    <header className="h-20 border-b flex items-center justify-between px-10 shrink-0 z-20">
                        <div className="flex items-center gap-4">
                            <span className="bg-blue-600 text-white px-4 py-1.5 rounded-xl font-black text-xs">PASSAGE {currentPassage + 1}</span>
                            <h2 className="font-bold text-slate-400 text-sm truncate max-w-sm">{passage.title}</h2>
                        </div>
                        <div className="flex items-center gap-8">
                            <div className="font-mono text-3xl font-black tracking-tighter text-slate-800">{formatTime(timeLeft)}</div>
                            <button onClick={() => setStatus('finished')} className="bg-red-500 hover:bg-red-600 text-white px-8 py-3 rounded-2xl text-sm font-black transition-all">NỘP BÀI</button>
                        </div>
                    </header>

                    <main className="flex-1 flex overflow-hidden">
                        {/* Text Panel */}
                        <div className="w-1/2 overflow-y-auto p-16 border-r scroll-smooth bg-white">
                            <div className="max-w-2xl mx-auto">
                                <h1 className="text-5xl font-black text-slate-900 mb-12 font-serif leading-tight">{passage.title}</h1>
                                <div className="passage-content text-lg text-slate-600" 
                                     dangerouslySetInnerHTML={{
                                         __html: passage.content.split('</span>').map(seg => {
                                             if (status === 'review' && reviewId && seg.includes(`id="${reviewId}"`)) {
                                                 return seg.replace(`id="${reviewId}"`, `id="${reviewId}" class="bg-yellow-200 ring-4 ring-yellow-400/20 rounded px-1 text-slate-900 font-bold transition-all duration-1000"`);
                                             }
                                             return seg;
                                         }).join('</span>')
                                     }} 
                                />
                            </div>
                        </div>

                        {/* Questions Panel */}
                        <div className="w-1/2 overflow-y-auto p-12 bg-slate-50 scroll-smooth">
                            <div className="max-w-xl mx-auto space-y-12">
                                {passage.groups.map((group, gIdx) => (
                                    <div key={gIdx} className="space-y-6">
                                        <div className="bg-amber-50 border-l-4 border-amber-400 p-6 rounded-r-2xl text-amber-900 italic font-medium text-sm">
                                            {group.instruction}
                                        </div>
                                        {group.questions.map(q => {
                                            const isCorrect = checkAns(answers[q.id], q.correct);
                                            return (
                                                <div key={q.id} className={`bg-white p-8 rounded-[2rem] shadow-sm border-2 transition-all ${status === 'review' && reviewId === q.sourceId ? 'border-blue-500 ring-8 ring-blue-50' : 'border-slate-100'}`}>
                                                    <div className="flex justify-between items-center mb-6">
                                                        <span className="text-[10px] font-black text-slate-400 tracking-widest uppercase">CÂU {q.id.replace('q','')}</span>
                                                        {status === 'review' && (
                                                            isCorrect ? <span className="text-green-600 text-xs font-black uppercase">Đúng</span> : <span className="text-red-600 text-xs font-black uppercase">Sai</span>
                                                        )}
                                                    </div>
                                                    <p className="text-slate-800 font-bold text-xl mb-8 leading-snug">{q.text}</p>
                                                    
                                                    {q.type === 'choice' ? (
                                                        <div className="space-y-3">
                                                            {q.options.map(opt => (
                                                                <button key={opt} disabled={status === 'review'} onClick={() => setAnswers({...answers, [q.id]: opt})}
                                                                        className={`w-full text-left p-4 rounded-xl border-2 transition-all text-sm font-bold flex items-center gap-4
                                                                            ${answers[q.id] === opt ? 'border-blue-500 bg-blue-50 text-blue-700' : 'border-slate-50 text-slate-500'}
                                                                            ${status === 'review' && opt.startsWith(q.correct.charAt(0)) ? 'border-green-500 bg-green-50' : ''}
                                                                        `}>
                                                                    <div className={`w-5 h-5 rounded-full border-2 ${answers[q.id] === opt ? 'bg-blue-600 border-blue-600' : 'border-slate-200'}`} />
                                                                    {opt}
                                                                </button>
                                                            ))}
                                                        </div>
                                                    ) : (
                                                        <input type="text" disabled={status === 'review'} value={answers[q.id] || ""} placeholder="Nhập đáp án..."
                                                               onChange={(e) => setAnswers({...answers, [q.id]: e.target.value})}
                                                               className={`w-full p-4 border-b-4 outline-none font-bold text-blue-600 bg-slate-50/50 rounded-t-xl ${status === 'review' ? (isCorrect ? 'border-green-500' : 'border-red-500') : 'border-slate-200 focus:border-blue-500'}`} />
                                                    )}

                                                    {status === 'review' && (
                                                        <div className="mt-8 pt-8 border-t border-slate-50">
                                                            <button onClick={() => { setReviewId(q.sourceId); document.getElementById(q.sourceId)?.scrollIntoView({behavior:'smooth', block:'center'}); }} 
                                                                    className="text-blue-600 text-xs font-black flex items-center gap-2 mb-4 hover:underline">
                                                                <InfoIcon /> XEM TRÍCH DẪN
                                                            </button>
                                                            <div className="bg-slate-50 p-6 rounded-2xl text-xs text-slate-500 leading-relaxed italic border">
                                                                <span className="font-black text-slate-700 uppercase block mb-1">Giải thích:</span>
                                                                {q.explanation}
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            )
                                        })}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </main>

                    <footer className="h-20 border-t flex items-center justify-between px-12 shrink-0">
                        <button disabled={currentPassage === 0} onClick={() => setCurrentPassage(prev => prev - 1)} className="text-slate-400 font-black text-xs uppercase disabled:opacity-20 flex items-center gap-2">← TRƯỚC</button>
                        <div className="flex gap-2">
                            {[0,1,2].map(idx => (
                                <button key={idx} onClick={() => setCurrentPassage(idx)} className={`w-10 h-10 rounded-xl font-black text-xs transition-all ${currentPassage === idx ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-400 hover:bg-slate-200'}`}>{idx + 1}</button>
                            ))}
                        </div>
                        <button disabled={currentPassage === 2} onClick={() => setCurrentPassage(prev => prev + 1)} className="text-slate-400 font-black text-xs uppercase disabled:opacity-20 flex items-center gap-2">SAU →</button>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
